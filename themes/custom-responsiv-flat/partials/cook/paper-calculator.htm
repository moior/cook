==
<?php
use Cook\Classes\FeeCalculator;
function onStart()
{
    $data = post();
   /*
    $obj = json_decode($data, true);
    echo json_encode($obj['data']);*/
    $rules = [
        '크기' => 'required',
        '수량' => 'required',
        '제본' => 'required|between:1,255'
        //..
    ];
    $validation = Validator::make($data, $rules);
    if ($validation->fails()) {
        throw new ValidationException($validation);
    }
    $fee = new FeeCalculator;

    /*paper.note.htm 의 form 안에 있는 정보*/
    /*한번에 $fee->setCate( aa, @data[ aa ] )*/
    $fee->setCate("제본"      , $data["제본"       ]);//제본에서 라벨링제본은 의미없음. 라벨스틱작업비에서 계산.
    $fee->setCate("크기"      , $data["크기"       ]);
    $fee->setCate("크기-내지"      , $data["크기-내지"       ]);
    $fee->setCate("표지-스타일" , $data["표지-스타일"  ]);// 인쇄, 박
    $fee->setCate("표지-방식" , $data["표지-방식"  ]);// 일반, 2합, 3합, 싸바리
    $fee->setCate("표지-용지" , $data["표지-용지"  ]);// 스노우 80g 등
    $fee->setCate("표지-평량" , $data["표지-평량"  ]);// <!--합지 포함 평량-->
    $fee->setCate("표지-코팅" , $data["표지-코팅"  ]);//
    $fee->setCate("표지-박"   , $data["표지-박"    ]);//<!--1천회 기준 10만-->
    $fee->setCate("표지-박개수"   , $data["표지-박개수"    ]);//
    $fee->setCate("표지-날개" , $data["표지-날개"  ]);//

    $fee->setCate("삽지-용지" , $data["삽지-용지"  ]);//
    $fee->setCate("삽지-평량" , $data["삽지-평량"  ]);//
    $fee->setCate("삽지-매수" , $data["삽지-매수"  ]);//

    $fee->setCate("내지-용지" , $data["내지-용지"  ]);// 미색모조 80g 등
    /*$fee->setCate("내지-평량" , $data["내지-평량"  ]);//*/
    $fee->setCate("내지-매수" , $data["내지-매수"  ]);//

    $fee->setCate("데코-라벨스틱", $data["데코-라벨스틱"]);//
    $fee->setCate("데코-라운딩", $data["데코-라운딩"]);//
    $fee->setCate("데코-OPP"  , $data["데코-OPP"   ]);
    /*$fee->setCate("수량"      , $data["수량"       ]);*/

    $fee->setCate("표지-인쇄"      , $data["표지-인쇄"       ]); // 단면4도
    $fee->setCate("삽지-인쇄"      , $data["삽지-인쇄"       ]); // 양면1도
    $fee->setCate("내지-인쇄"      , $data["내지-인쇄"       ]); // 양면1도

    $fee->setQuantity( $data['수량'] );
    $this["수량"] = $data['수량'];

    /*$fee->setCate('제본', $data['제본']);
    $fee->setCate('표지', $data['표지']);
    $fee->setCate('내지', $data['내지']);
    $fee->setCate('크기', $data['크기']);
    $fee->setCate('매수', $data['매수']);
    */

    $this["표지_종이값"] = $fee->feeCoverPaper("real"); /*사이즈따른 1장가격 x 표지페이지(보통은2) x 수량 x 종이값*/
    $this["표지_인쇄비"] = $fee->feeCoverPrint("real");
    $this["표지_판비"] = $fee->feeCoverPan("real");
    $this["표지_코팅비"] = $fee->feeCoverCoating("real");
    $this["표지_박비"] = $fee->feeCoverBak("real");
    $this["표지_날개비"] = $fee->feeCoverWing("real");

    $this["삽지_종이값"] = $fee->feeIntroPaper("real");
    $this["삽지_인쇄비"] = $fee->feeIntroPrint("real");
    $this["삽지_판비"]   = $fee->feeIntroPan("real");

    $this["내지_종이값"] = $fee->feeInnerPaper("real");
    $this["내지_인쇄비"] = $fee->feeInnerPrint("real");
    $this["내지_판비"]   = $fee->feeInnerPan("real");

    $this["제본비"] = $fee->feeJebon("real");

    $this["라운딩비"] = $fee->feeRounding("real");
    $this["포장비"] = $fee->feeOPP("real");
    $this["라벨작업비"] = $fee->feeLarvelStick("real");

    $this["디자인_표지"] = "111";
    $this["디자인_삽지"] = "2";
    $this["디자인_내지"] = "3";

    $this['필요R수_표지'] = round($fee->numNeededR("표지"), 2);
    $this['필요R수_삽지'] = round($fee->numNeededR("삽지"), 2);
    $this['필요R수_내지'] = round($fee->numNeededR("내지"), 2);
    $this['내지한장가격'] = round($fee->feePaper1page(), 1);


    $this['제본비1권'] = ceil($fee->feeJebon1book());

    $this['한권가격'] = $fee->feeEach();
    //$this['usersetting'] = $fee->getUserSetting(); // 배열을 확인할 길이 없음..ㅠ
    $this['최종가격_수량으로계산'] = number_format($fee->feeFinal_byQuantity());

    $final = $this["표지_종이값"] +    $this["표지_인쇄비"] +    $this["표지_판비"] +
            $this["표지_코팅비"] +    $this["표지_박비"] +    $this["표지_날개비"]+

            $this["삽지_종이값"] +    $this["삽지_인쇄비"] +    $this["삽지_판비"] +
            $this["내지_종이값"] +    $this["내지_인쇄비"] +    $this["내지_판비"] +

            $this["제본비"] +    $this["라운딩비"] +    $this["포장비"] +   $this["라벨작업비"] +
            $this["디자인_표지"] +    $this["디자인_삽지"] +    $this["디자인_내지"] ;
    //$final = FeeCalculator::feeNote(); // + 제단비() + 제본비() + 포장비() + 배송비();
    $this['합계금액'] = number_format($final);
}
?>
==
<script>

</script>


<style>
    #div_payment {padding:10px 0px;font-size:9pt;text-align:center;}
    #number_payment {color:tomato;font-size:1.5em;font-weight:bold;}
    .step-final-title {font-weight:bold;font-size:1.1em;}
    .step-final-content {text-align:left;overflow-x:hidden;}
    .step-final-content2 {border-bottom:1px dotted gray;}
    .bill-row {padding-left:5px;}
</style>

<div id="div_payment" class="">

    <div class="final-title" style="font-weight:bold;font-size:1.2em;">견 적 서</div>
    <div class="row bill-row">

        <div class="step-final-title col-xs-2">표지</div>
        <div class="step-final-content col-xs-10">
            <div class="step-final-content2">

                <div>종이값 : {{ 표지_종이값|number_format() }} 원</div>
                <div>인쇄비 : {{ 표지_인쇄비|number_format() }} 원</div>
                <div>판비 : {{ 표지_판비|number_format() }} 원</div>
                {% if 표지_코팅비 %}
                    <div>코팅 : {{ 표지_코팅비|number_format() }} 원</div>
                {% endif %}
                {% if 표지_박비 %}
                    <div>박 : {{ 표지_박비|number_format() }} 원</div>
                {% endif %}
                {% if 표지_날개비 %}
                    <div>책날개 : {{ 표지_날개비|number_format() }} 원</div>
                {% endif %}
            </div>
        </div>
    </div>

    <div class="row bill-row">
        <div class="step-final-title col-xs-2">삽지</div>
        <div class="step-final-content col-xs-10">
            <div class="step-final-content2">

                <div>종이값 : {{ 삽지_종이값 }} 원</div>
                <div>인쇄비 : {{ 삽지_인쇄비 }} 원</div>
                <div>판비 : {{ 삽지_판비 }} 원</div>
            </div>
        </div>
    </div>
    <div class="row bill-row">
        <div class="step-final-title col-xs-2">내지</div>
        <div class="step-final-content col-xs-10">
            <div class="step-final-content2">
                <div>종이값 : {{ 내지_종이값|number_format() }} 원</div>
                <div>인쇄비 : {{ 내지_인쇄비|number_format() }} 원</div>
                <div>판비 : {{ 내지_판비|number_format() }} 원</div>
            </div>
        </div>
    </div>
    <div class="row bill-row">
        <div class="step-final-title col-xs-2">작업</div>
        <div class="step-final-content col-xs-10">
            <div class="step-final-content2">
                <div>제본비 : {{ 제본비|number_format() }} 원</div>
                {% if 라벨작업비 %}
                    <div>라벨스틱 : {{ 라벨작업비|number_format() }} 원</div>
                {% endif %}
                {% if 라운딩비 %}
                    <div>라운딩 : {{ 라운딩비|number_format() }} 원</div>
                {% endif %}
                {% if 포장비 %}
                    <div>포장비 : {{ 포장비|number_format() }} 원</div>
                {% endif %}
                <div>디자인 : {{ (디자인_표지 +  디자인_삽지 + 디자인_내지) }} 원</div>
            </div>
        </div>
     </div>


<!--
    <div class="step-final-title">권당 가격</div>
    <div class="step-final-content">
        <div>표지한장가격 : {{ 표지_종이값 / 수량 }} 원</div>
        <div>내지한장가격 : {{ 내지한장가격 }} 원</div>
        <div>제본비용 : {{ 제본비1권 }} 원</div>
        <div>한권가격 : {{ 한권가격 }} 원</div>
    </div>
    <div  class="step-final-title">최종 가격</div>
    <div class="step-final-content">
        <div>필요R수-표지 : {{ 필요R수-표지 }}</div>
        <div>필요R수-삽지 : {{ 필요R수-삽지 }}</div>
        <div>필요R수-내지 : {{ 필요R수-내지 }}</div>
        <div>최종가격-수량으로계산 : {{ 최종가격-수량으로계산 }} 원</div>
    </div>-->
    <p>
        <span id="number_payment">{{ 합계금액 }}</span>원
    </p>
    <!--<p>
        <span id="" class="btn btn-default">인쇄하기</span>
    </p>-->

</div>