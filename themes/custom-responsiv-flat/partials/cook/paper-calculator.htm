[Bill]
type = Final

==
<?php
use Cook\Classes\FeeCalculator;
function onStart()
{
    $data = post();
   /*
    $obj = json_decode($data, true);
    echo json_encode($obj['data']);*/
    $rules = [
        '크기' => 'required',

        '제본' => 'required'
        //..'수량' => 'required',
    ];
    $validation = Validator::make($data, $rules);
    if ($validation->fails()) {
        throw new ValidationException($validation);
    }
    $fee = new FeeCalculator;

    /*paper.note.htm 의 form 안에 있는 정보*/
    /*한번에 $fee->setCate( aa, @data[ aa ] )*/
    foreach($data as $key=> $data_){
        $fee->setCate($key, $data_);
    }/*
    $fee->setCate("제본"      , $data["제본"       ]);//제본에서 라벨링제본은 의미없음. 라벨스틱작업비에서 계산.
    $fee->setCate("크기"      , $data["크기"       ]);
    $fee->setCate("크기-내지"      , $data["크기-내지"       ]);

    $fee->setCate("표지-스타일" , $data["표지-스타일"  ]);// 인쇄, 박
    $fee->setCate("표지-방식" , $data["표지-방식"  ]);// 일반, 2합, 3합, 싸바리
    $fee->setCate("표지-용지" , $data["표지-용지"  ]);// 스노우 80g 등
    $fee->setCate("표지-평량" , $data["표지-평량"  ]);// <!--합지 포함 평량-->
    $fee->setCate("표지-코팅" , $data["표지-코팅"  ]);//
    $fee->setCate("표지-박"   , $data["표지-박"    ]);//<!--1천회 기준 10만-->
    $fee->setCate("표지-박개수"   , $data["표지-박개수"    ]);//
    $fee->setCate("표지-날개" , $data["표지-날개"  ]);//

    $fee->setCate("삽지-용지" , $data["삽지-용지"  ]);//
    $fee->setCate("삽지-평량" , $data["삽지-평량"  ]);//
    $fee->setCate("삽지-매수" , $data["삽지-매수"  ]);//

    $fee->setCate("내지-용지" , $data["내지-용지"  ]);// 미색모조 80g 등
    $fee->setCate("내지-평량" , $data["내지-평량"  ]);//
    $fee->setCate("내지-매수" , $data["내지-매수"  ]);//

    $fee->setCate("데코-라벨스틱", $data["데코-라벨스틱"]);//
    $fee->setCate("데코-라운딩", $data["데코-라운딩"]);//
    $fee->setCate("데코-OPP"  , $data["데코-OPP"   ]);


    $fee->setCate("표지-인쇄"      , $data["표지-인쇄"       ]); // 단면4도
    $fee->setCate("삽지-인쇄"      , $data["삽지-인쇄"       ]); // 양면1도
    $fee->setCate("내지-인쇄"      , $data["내지-인쇄"       ]); // 양면1도

    $fee->setCate("디자인"  , $data["디자인"   ]);*/
    /*$fee->setCate("수량"      , $data["수량"       ]);*/
    $this["수량"] = $data['수량'];
    if($this['수량'] == 0){
        $this['합계금액'] = 0;

    }else{
        $fee->setQuantity( $data['수량'] );

        $this["표지_종이값"] = $fee->feeCoverPaper("real"); /*사이즈따른 1장가격 x 표지페이지(보통은2) x 수량 x 종이값*/
        $this["표지_인쇄비"] = $fee->feeCoverPrint("real");
        $this["표지_판비"] = $fee->feeCoverPan("real");
        $this["표지_코팅비"] = $fee->feeCoverCoating("real");
        $this["표지_박비"] = $fee->feeCoverBak("real");
        $this["표지_날개비"] = $fee->feeCoverWing("real");

        $this["삽지_종이값"] = $fee->feeIntroPaper("real");
        $this["삽지_인쇄비"] = $fee->feeIntroPrint("real");
        $this["삽지_판비"]   = $fee->feeIntroPan("real");

        $this["내지_종이값"] = $fee->feeInnerPaper("real");
        $this["내지_인쇄비"] = $fee->feeInnerPrint("real");
        $this["내지_판비"]   = $fee->feeInnerPan("real");

        $this["제본비"] = $fee->feeJebon("real");

        $this["라운딩비"] = $fee->feeRounding("real");
        $this["포장비"] = $fee->feeOPP("real");
        $this["라벨작업비"] = $fee->feeLarvelStick("real");

        $this["디자인비"] = $fee->feeDesign("real");

        $this['필요R수_표지'] = round($fee->numNeededR("표지"), 2);
        $this['필요R수_삽지'] = round($fee->numNeededR("삽지"), 2);
        $this['필요R수_내지'] = round($fee->numNeededR("내지"), 2);
        $this['내지한장가격'] = round($fee->feePaper1page(), 1);


        $this['제본비1권'] = ceil($fee->feeJebon1book());

        $this['한권가격'] = $fee->feeEach();
        //$this['usersetting'] = $fee->getUserSetting(); // 배열을 확인할 길이 없음..ㅠ
        $this['최종가격_수량으로계산'] = number_format($fee->feeFinal_byQuantity());

        $final = $this["표지_종이값"] +    $this["표지_인쇄비"] +    $this["표지_판비"] +
            $this["표지_코팅비"] +    $this["표지_박비"] +    $this["표지_날개비"]+

            $this["삽지_종이값"] +    $this["삽지_인쇄비"] +    $this["삽지_판비"] +
            $this["내지_종이값"] +    $this["내지_인쇄비"] +    $this["내지_판비"] +

            $this["제본비"] +    $this["라운딩비"] +    $this["포장비"] +   $this["라벨작업비"] +
            $this["디자인비"]  ;
        //$final = FeeCalculator::feeNote(); // + 제단비() + 제본비() + 포장비() + 배송비();
        $this['합계금액'] = number_format($final);
    }

}
?>
==
<script>
$(function(){
    /*계산서 보이면서 깜빡거리도록*/
    $("#div_payment").css('backgroundColor', 'gold')
        .animate({backgroundColor: '#FFFFFF'}, '2000', 'linear');
})
</script>

<div >
    {% component "Bill" %}
</div>