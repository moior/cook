title = "주문관리"
url = "/order/manage/:orderno?"
layout = "cooking"
is_hidden = 0


[Orders]
[OrderDetail]
id = {{ :orderno }}

[Memos]
attach_type = "Order"
attach_id = {{ :orderno }}

[Notecooker]

[Invoices]
order_id = {{ :orderno }}

[InvoiceManager]

[session]
==
<?php
/*use Symfony\Component\HttpFoundation\File\File as FileObj;*/

function onInit()
{
    $this["orderno"] = $this->param('orderno'); //파라매터 받는법?
}

function onStart()
{
    /*$file = new FileObj("assets/images/cook/paper/note/jebon/샘플-떡제본.jpg");
    $temp["thumb"] = $file->getThumb(140, 160, ['mode'=>'crop']);*/
}
function onClickStep1(){}
function onClickStep2(){}

/*메인 데스크(partial)에서 세부사항 선택시, 이곳(page)에서 가격 계산 / 동시에 js로 이곳 input 에 저장*/
function onCalcFee(){

}

?>
==


<script>

    function setFormInputData(){
        $(".select_part").each(function(){
            $("#input-" + $(this).attr("name")).val(
                $(this).find("option:selected").val()
            );
        });
    }
    function setAreaDisplay(){
        var quantity = $("#select_amount option:selected").val();
        if( quantity == "" || quantity == '소량') {
            $(".div_파트선택영역").hide();
            $("#div_삽지영역").hide();
        }else{
            $(".div_파트선택영역").show();
            if( $("#checkbox_삽지있음").prop("checked") == true ){
                $("#div_삽지영역").show();
            }else $("#div_삽지영역").hide();
        }
        if( $("#select-제본 option:selected").val() == "스프링") {
            $("#select-데코-라벨스틱").prop("disabled", false);
        }else $("#select-데코-라벨스틱").prop("disabled", true);


    }
    function showDetailPayment(){
        /*가격 계산*/
        var datas = $("#form-currentnote").serializeArray(); //JSON.stringify(
        //console.log("111111 "+datas);
        $.request('onCalcFee', {
            update: { 'cook/paper-calculator': '#div_brief' },
            data: datas,
        })
    }


    $(document).ready(function(){
        setFormInputData();
        setAreaDisplay();
        showDetailPayment();


        $(".select_part").change(function(){
            setFormInputData();
            setAreaDisplay();
            showDetailPayment();
        });

        $("#btn견적서로드").click(function(){
            showDetailPayment();
        });

        /* Orders 플러그인에 쓰이는 jquery */
        $(".span주문제목").click(function(){
            location.href="/order/manage/" + $(this).parents(".tr주문").data("id");
        })

        /* Orders 플러그인에 쓰이는 jquery 끝 */

        /*따라다니는 메뉴*/
        var isMobile = true;
        if($(window).innerWidth() >= 760) {
            //if (window.matchMedia("(min-width: 760px)").matches) { // matchMedia는 ex 10, 11만됨
            isMobile = false;
        }
        if(isMobile == false){
            /*var floatPosition1 = parseInt($("#area이미지").css('top'));// 250px 에서 숫자만
             $(window).scroll(function() {
             var newPosition = $(window).scrollTop() + floatPosition1 + "px"; // 현재 스크롤 위치를 가져온다.
             $("#area이미지").css('top', newPosition);
             });*/

            var floatPosition2 = $("#area견적서").css('top'); //parseInt(.css('top'));// Exp에서 'auto'라고 나옴 / 250px 에서 숫자만
            //var floatPosition2 = parseInt($("#area견적서").position().top); //parseInt(.css('top'));// Exp에서 'auto'라고 나옴 / 250px 에서 숫자만
            if(floatPosition2 == 'auto') floatPosition2 = 0; //ex때문에
            else floatPosition2 = parseInt(floatPosition2);
            $(window).scroll(function() {
                var newPosition = $(window).scrollTop() + floatPosition2 + "px"; // 현재 스크롤 위치를 가져온다.
                //$("#area견적서").css('top', newPosition);
            });

        }else{

        }

        /*Memo 플러그인 전용 JS*/
        $(".btn메모삭제").click(function(){
            if( confirm("메모를 삭제할까요? (지금은 안됨)") ){
                //메모 삭제 로직
            }
        })

    })
</script>

<style>

    #cookdesk-center {border-left:0px solid gray;border-right:0px solid gray;min-height:100px;}
    #area이미지 {padding:5px;}
    #area노트조합기 {
        padding:5px 10px 5px 10px;
        border-left:0px solid gray;
        margin-top:10px;
    }

    #area견적서 {padding:0px;}

    #bodyWrap {
        background-image:url('{{ "assets/images/cook/site/주문페이지/노트요리사_주문_BG.jpg"|theme }}');
        background-size: contain;
        background-repeat: no-repeat;
        background-position:right top;
        background-size:auto 100% ;
    }


</style>

<div id="bodyWrap">
    <div class="container">

        <div id="area_top" class="row" style="font-size:11pt;padding:5px;border-top:2px solid #555;border-bottom:2px solid #555;">
            <div class="col-sm-5">
                주문관리 (견적발송)
            </div>
            <div class="col-sm-7 text-right">
                <span style="margin:0px 25px;"></span>
                <span style="">문의 1661-5521</span>
            </div>
        </div>
        <div id="area_top_banner" class="row">

        </div>


        <div id="area전체" class="row">

            <div class="col-sm-5" id="area이미지" style="">
                <div id="area주문정보">
                    <a class="btn btn-sm" id="btn퀵주문입력">새주문</a>

                    {% component "OrderDetail" %}



                    <h5>메모</h5>
                    {% component "Memos" %}


                    <h5>발송한 견적서</h5>
                    {% component "Invoices" %}

                </div>


            </div>

            <div class="col-sm-4" id="">

                <div id="area노트조합기">
                    {% component "Notecooker" %}
                </div>


            </div>



            <div class="col-sm-3" id="area견적서" style="margin-top:15px;">
                <!--견적서부분-->
                <div id="div_brief" style="background-color:#ffffff;border:1px solid gray;border-bottom:1px solid gray;"></div>

                <div class="text-align">

                    <div class="row" id="div표지직접입력박스">
                        <div class="col-xs-6" style="padding:0px;">
                            <input type="text" name="표지_직접1_항목" id="input-표지_직접1_항목" value="" placeholder="표지 항목추가" class="form-control" />
                        </div>
                        <div class="col-xs-5" style="padding:0px;">
                            <input type="text" name="표지_직접1_비용" id="input-표지_직접1_비용" value="" placeholder="추가비용" class="form-control"  />
                        </div>
                        <div class="col-xs-1" style="padding:0px;">
                            <button type="button" id="btn견적서로드">+</button>
                        </div>
                    </div>
                    <script>
                        $(document).ready(function() {
                            $("#div표지직접입력박스").appendTo("#form-currentnote");
                        });


                    </script>

                    <button class="btn btn-sm" class="btn견적추가">견적추가</button>
                </div>
            </div>

        </div><!--row-->

        <div id="area가변견적">
            {% component "InvoiceManager" %}
        </div>
        <div class="col-sm-12" id="cookdesk-center">


        </div>
        <div id="area전체리스트" style="background-color: white;">
            <h3>전체 리스트</h3>
            {% component "Orders" %}

        </div>
    </div>



</div>


