
<style>
    .table td, .table th {}
    #div주문상세 {background-color:white;padding:7px;margin-top:10px;}
</style>
<script>
$(document).ready(function(){
    //$("#select상태").select2(); // 왜 안됨 ㅜ.ㅜ

    $("#select상태 option[value='{{order.status_show}}']").prop("selected", true);
    $("#select상태").change(function(){
        var txt상태 = $("#select상태 option:selected").val();
        var datas = {   'order_id' : {{ order.id }},
                        'status_show' : txt상태 ,
        }
        $.request("onUpdateStatus", {
            data: datas,
            success: function(){
                $("#text상태").text( txt상태 );
            }
        })
    });
    $("#btn상태입력").click(function(){
        var txt상태 = $("#input상태").val();
        var datas = {   'order_id' : {{ order.id }},
                        'status_show' : txt상태 ,
        }
        $.request("onUpdateStatus", {
            data: datas,
            success: function(){
                $("#text상태").text( txt상태 );
            }
        })
    })

})

</script>

<!--<form data-request="{{ __SELF__ }}::onOrderPaper">
여기서는 __self__하면되네
</form>-->
<div id="div주문상세">
    <p></p>
    {% if order %}
        <div class="">
            {% if order.name %}
            <h5>{{ order.name }}님의 주문정보</h5>
            {% endif %}

            <div><b>주문시각</b> : {{ order.created_at|slice(0, -3) }}</div>
            <div><b>제목</b> : {{ order.title }}</div>

            <div>
                <b>성함</b> : {{ order.name }}
                ( <span><b>폰</b> : <a href="tel:{{ order.phone }}">{{ order.phone }}</a></span> )
            </div>

            <div><b>메일</b> : <a href="mailto:{{ order.email }}">{{ order.email }}</a></div>
            <div style="border-bottom:1px dotted gray;">
                <b>배송주소</b> : {{ order.addr }}
            </div>

            <div style="border-bottom:1px dotted gray;">
                {{ order.spec }}
            </div>

            <div style="border-bottom:1px dotted gray;"><b>메모</b>
                <div class="well well-sm">{{ order.comment|nl2br }}</div>
            </div>
            <div style="border-bottom:1px dotted gray;">
                <b>선택한 샘플</b> :
                <a href="/sample/detail/{{ order.sample_code }}" target="_blank">
                    {{ order.sample_code }}
                </a>
            </div>

            <div style="border-bottom:1px dotted gray;">
                자동계산된 금액 :
                {% if order.fee_offer == 0 %}
                    미확정
                {% else %}
                    {{ order.fee_offer|number_format }}
                {% endif %}
            </div>
            <div style="border-bottom:1px dotted gray;">
                <b>상태</b> :
                <span style="color:royalblue" id="text상태">{{ order.status_show?:"확인중"  }}</span>

                <form class="form-inline">
                    <select name="status_select" id="select상태"  class="input-sm form-control">
                        <option value=""></option>
                        <option value="견적접수">견적접수</option>
                        <option value="입금확인중">입금확인중</option>
                        <option value="상담완료">상담완료</option>
                        <option value="제작완료">제작완료</option>
                    </select>
                    <div class="form-group">
                        <input type="text" name="status_show" id="input상태" class="input-sm form-control" placeholder="자유입력"/>
                    </div>
                    <button type="button" id="btn상태입력" class="btn btn-xs">변경</button>
                </form>

            </div>

        </div>
        <br/>
        <!--첨부파일이 있으면 -->
        {% if upload_file_arr[key] %}
        <a href="{{upload_file_arr[key]}}" target="_blank">파일</a>
        {% endif %}
        {% if order.bill %}

        <a href="javascript:void(0);" onclick="$(this).next('.div상세견적서보기').toggle();">
            견적서
        </a>
        <div id="" class="div상세견적서보기" style="display:none;background-color:#efefef;">
            <!--DB에 저장되어 있는 정보-->
            <small>{{ order.bill|raw  }}</small>
        </div>
        {% endif %}



        {% if cook_data %}
        <a href="javascript:void(0);" onclick="$(this).next('.div상세주문내용보기').toggle();">
            [스펙상세]
        </a>
            <div id="" class="div상세주문내용보기"
                 style="display:none;background-color:#efefef;padding:10px; font-size:0.8em;">
            <!--DB에 저장되어 있는 정보-->
            <table class="table table-sm">
                {% for key2, cook_data__ in cook_data %}
                <tr>
                    <td>{{ key2 }}</td>
                    <td>{{ cook_data__ }} </td>
                </tr>
                {% endfor %}
            </table>
        </div>

        {% endif %}

    {% else %}
        <h5>리스트에서 클릭해주세요</h5>
    {% endif %}

</div>
